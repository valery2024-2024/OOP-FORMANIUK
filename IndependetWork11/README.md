# Самостійна робота №11 — Polly/Retry (короткий звіт)

**Тема:** Кейси `Polly/Retry`: короткий звіт.  
**Мета:** Дослідити реальні сценарії використання `Polly` для відмовостійкості (`.NET Retry, Circuit Breaker, Timeout`).

У проєкті `IndependentWork11` встановив пакети:

`dotnet add package Polly`
`dotnet add package Polly.Extensions.Http`

1. Сценарій 1 - Зовнішнє `API` тимчасово недоступне
Проблема

Іноді зовнішні `API` падають на кілька секунд (сервер перевантажений або мережа).
Якщо відразу здатися - програма буде часто ламатися.

Політика Polly
`Retry` з експоненційною затримкою.

Чому так:
* Retry дає шанс API відновитись.
* Експоненційна затримка (1с, 2с, 4с) не спамить сервер.

У коді зробив так:
* 2 перші виклики кидають `HttpRequestException`
* 3-й виклик проходить нормально
* `Retry` робить повтори автоматично і пише лог.

Очікувана поведінка / логи
* 1 спроба - помилка
* `Retry` 1 (через 1с)
* 2 спроба - помилка
* `Retry` 2 (через 2с)
* 3 спроба - успіх

2. Сценарій 2 - Запит до БД зависає
Проблема
База даних може довго відповідати (блокування, навантаження).
Тоді програма просто чекає і висить.

Політика `Polly`
`Timeout` + `Retry`

Чому так:
* `Timeout` відріже дуже довгі запити.
`Retry` дасть 1–2 додаткових спроби (бо зависання — випадкова штука).

* 1-й запит спеціально роблю Task.Delay(3000) → отримуємо timeout.
* `Polly` кидає `TimeoutRejectedException`.
* `Retry` ловить і повторює.
* 2-й виклик йде швидко і успішно.

Очікувана поведінка / логи
* `DB attempt` 1 - зависання - `timeout`
* `Retry DB` 1
* `DB attempt` 2 - успіх

3. Сценарій 3 - Черга повідомлень перевантажена
Проблема

Якщо сервіс/черга перевантажені, повтори тільки збільшують проблему.
Треба тимчасово зупинитись, щоб не добити систему.

Політика `Polly`

`Circuit Breaker` + `Fallback`

Чому так:
* `Circuit Breaker` після 2 помилок відкривається і блокує запити на 5 секунд.
* `Fallback` дає запасний варіант (наприклад, зберегти локально).

* Перші 3 відправки падають - `breaker` відкрився.
* Далі виклики одразу йдуть у `Fallback`.
* Після паузи `breaker` переходить у `half-open`, тестує і відновлюється.

Очікувана поведінка / логи
* 1 помилка, 2 помилка - `Circuit OPEN`
* Далі `BrokenCircuitException` - `Fallback`
* Після 5 сек - `HALF-OPEN` - виклик - `RESET`

## Загальні висновки

`Polly` реально робить `.NET`-застосунок відмовостійким:
* `Retry` рятує від тимчасових помилок (мережа, `API`).
* `Timeout` не дає програмі зависнути.
* `Circuit Breaker` захищає від засипання сервісу повторними запитами.
* `Fallback` дозволяє не втрачати дані навіть якщо сервіс упав.

Як на мене, це дуже корисна бібліотека для реальних проєктів, бо вона проста,
але сильно піднімає стабільність програми.
